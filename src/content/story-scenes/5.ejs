<div id="scene-5" style="text-align: center">
  <style>
    @media (prefers-reduced-motion: reduce) {
      #scene-5 .fade-in,
      #scene-5 .line-fade-in {
        animation: none !important;
        opacity: 1 !important;
        transform: none !important;
      }
    }
    #scene-5 .fade-in {
      opacity: 0;
      transform: translateY(6px);
    }
    #scene-5 .fade-in.start {
      animation: sceneFadeIn 1000ms ease-out forwards;
    }
    #scene-5 .line-fade-in {
      opacity: 0;
      transform: translateY(4px);
    }
    #scene-5 .line-fade-in.start {
      animation: sceneFadeIn var(--line-dur, 1000ms) ease-out forwards;
    }
    @keyframes sceneFadeIn {
      to {
        opacity: 1;
        transform: none;
      }
    }
    #scene-5 .continue {
      opacity: 0;
      pointer-events: none;
    }
    #scene-5 .continue.show {
      transition: opacity 300ms ease-in;
      opacity: 1;
      pointer-events: auto;
    }
    #scene-5 .skip {
      animation: none !important;
      opacity: 1 !important;
      transform: none !important;
    }
    #scene-5 {
      cursor: pointer;
    }
  </style>
  <div
    style="
      max-width: 65ch;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    "
  >
    <p class="fade-in">
      <em
        >Die Gruppe sitzt beim Frühstück, als ein Gong ertönt und eine Durchsage
        durch das Raumschiff schallt</em
      >
    </p>

    <p class="fade-in">
      <span class="line-fade-in"
        >„Gestern Abend wurde die Beleuchtung manipuliert und ein verbotenes
        Symbol dargestellt. Das ist ein grober Verstoß gegen die Bord-Regeln.
        Hinweise, die zur Ergreifung der verursachenden Person führen, werden
        mit 100.000 Credits belohnt. Wir bedanken uns für Ihre Mithilfe.“</span
      >
    </p>

    <p class="fade-in">
      <span class="line-fade-in"
        ><strong>Josh</strong>: Ach, sollen sie sich mal nicht so. Ich bin mir
        sicher, dass keine Bord-Regel sowas verbietet!</span
      ><br />
      <span class="line-fade-in"
        ><strong>Kiwi</strong>: Warte mal. Bex, wo warst du eigentlich gestern,
        als das passiert ist? Ich hab dich nach dem Abendessen nicht mehr
        gesehen.</span
      ><br />
      <span class="line-fade-in"
        ><strong>Bex</strong>: (nimmt einen übertrieben großen Bissen Toast) Hm,
        ist gestern Abend was passiert? Davon hab ich nichts mitbekommen, war in
        meinem Pod …</span
      ><br />
      <span class="line-fade-in"
        ><strong>Kiwi</strong>: (schmunzelt) Diesen Gesichtsausdruck kenne ich
        gut genug. Das bedeutet nie was Gutes.</span
      ><br />
      <span class="line-fade-in"
        ><strong>Bex</strong>: Psssst. Du hast ja gehört, der grobe Verstoß wird
        sicherlich auch hart bestraft. Wir sollten es vermeiden, dass jemand in
        so eine Situation kommt. Wäre ganz schlimm.</span
      >
    </p>

    <p class="fade-in"><em>Bex schaut kurz auf die Uhr und springt auf.</em></p>

    <p class="fade-in">
      <span class="line-fade-in"
        ><strong>Bex</strong>: Oh, ich muss los. Hab gestern einen Jungen
        kennengelernt und ich bringe ihm gerade Holo-Schach bei. Ist ein guter
        Schüler, kann ich nicht warten lassen. Bye!</span
      >
    </p>

    <p class="fade-in"><em>Und schon sprintet Bex los.</em></p>

    <p class="fade-in">
      <span class="line-fade-in"
        ><strong>Kiwi</strong>: Denkst du, Bex war das gestern?</span
      ><br />
      <span class="line-fade-in"
        ><strong>Josh</strong>: Bei der Reaktion? Ziemlich sicher. Hut ab, Bex
        hat echt Mut. Und Herz. Eine wunderbare Mischung.</span
      >
    </p>
  </div>
  <form
    id="scene-5-continue"
    class="continue"
    action="/story/5/complete"
    method="post"
    aria-hidden="true"
  >
    <input type="submit" class="btn btn-interaction btn-sm" value="Weiter" />
  </form>
  <script>
    ;(function () {
      var c = document.getElementById('scene-5')
      if (!c) return
      var reduce =
        window.matchMedia &&
        window.matchMedia('(prefers-reduced-motion: reduce)').matches
      var btn = c.querySelector('#scene-5-continue')
      var ps = c.querySelectorAll('p.fade-in, blockquote.fade-in')
      var P_DUR = 4000,
        L_GAP = 600
      function calcDur(s) {
        var w = (s || '').trim().split(/\s+/).filter(Boolean).length
        var d = 2400 + w * 120
        if (d < 2400) d = 2400
        if (d > 7000) d = 7000
        return d
      }
      // Precompute CSS vars for line durations
      for (var i = 0; i < ps.length; i++) {
        var ls0 = ps[i].querySelectorAll('.line-fade-in')
        for (var j = 0; j < ls0.length; j++) {
          var d0 = calcDur(ls0[j].textContent || '')
          var clamped = Math.min(d0, 1000)
          ls0[j].style.setProperty('--line-dur', clamped + 'ms')
        }
      }
      var state = {
        pi: 0,
        li: -1,
        timeout: null,
        currentEl: null,
        currentType: null,
      }
      function showContinue() {
        if (btn) {
          btn.classList.add('show')
          btn.removeAttribute('aria-hidden')
        }
        if (c) c.style.cursor = 'auto'
      }
      function nextParagraph(immediate) {
        state.pi++
        if (state.pi < ps.length) startParagraph(state.pi, immediate)
        else showContinue()
      }
      function startParagraph(i, immediate) {
        var p = ps[i]
        p.classList.add('start')
        state.currentEl = p
        state.currentType = 'paragraph'
        state.li = -1
        var ls = p.querySelectorAll('.line-fade-in')
        if (ls.length) {
          if (immediate) {
            startLine(0)
          } else {
            state.timeout = setTimeout(function () {
              startLine(0)
            }, P_DUR)
          }
        } else {
          if (immediate) {
            nextParagraph(true)
          } else {
            state.timeout = setTimeout(function () {
              nextParagraph(false)
            }, P_DUR)
          }
        }
      }
      function startLine(j) {
        var p = ps[state.pi]
        var ls = p.querySelectorAll('.line-fade-in')
        state.li = j
        var line = ls[j]
        line.classList.add('start')
        state.currentEl = line
        state.currentType = 'line'
        var d = calcDur(line.textContent || '')
        state.timeout = setTimeout(function () {
          if (j + 1 < ls.length) startLine(j + 1)
          else nextParagraph()
        }, d + L_GAP)
      }
      function skipCurrent() {
        if (state.timeout) {
          clearTimeout(state.timeout)
          state.timeout = null
        }
        if (state.currentEl) state.currentEl.classList.add('skip')
        if (state.currentType === 'paragraph') {
          var ls = ps[state.pi].querySelectorAll('.line-fade-in')
          if (ls.length) startLine(0)
          else nextParagraph(true)
        } else if (state.currentType === 'line') {
          var p = ps[state.pi]
          var ls2 = p.querySelectorAll('.line-fade-in')
          if (state.li + 1 < ls2.length) startLine(state.li + 1)
          else nextParagraph()
        } else {
          startParagraph(state.pi, true)
        }
      }
      function startSequence() {
        if (reduce) {
          for (var i = 0; i < ps.length; i++) {
            ps[i].classList.add('skip')
            ps[i].classList.add('start')
            var ls = ps[i].querySelectorAll('.line-fade-in')
            for (var j = 0; j < ls.length; j++) {
              ls[j].classList.add('skip')
              ls[j].classList.add('start')
            }
          }
          showContinue()
          return
        }
        startParagraph(0, false)
        c.addEventListener('click', function (ev) {
          if (ev.target && ev.target.closest && ev.target.closest('.continue'))
            return
          skipCurrent()
        })
      }
      if ('IntersectionObserver' in window) {
        new IntersectionObserver(
          function (e, o) {
            if (e[0].isIntersecting) {
              startSequence()
              o.disconnect()
            }
          },
          { threshold: 0.1 }
        ).observe(c)
      } else {
        startSequence()
      }
    })()
  </script>
</div>
