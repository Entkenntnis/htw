<% if (!props.accessible) { %>
  <p><i><%= t('locked')%></i></p>
<% } else { %><p>
    <% if (props.correct !== true) { %>
      <a href="<%=prefix%>/map" <%- App.config.historyBack ? 'onclick="goBack()"' : ''%>><%= t('back') %></a><span style="display: inline-block; margin-left:8px; margin-right: 8px; color: #313131">•</span>
    <% } %>
    <span style="color: gray">
      <%= props.ratio %>
    </span>
    <% if (props.challenge.date) { %><span style="display: inline-block; margin-left:8px; margin-right: 8px; color: #313131">•</span>
      <span style="color:gray"><%= t('created')%> <%= App.moment(props.challenge.date).locale(locale).fromNow()%>
        <% if (props.challenge.author) { %>
          <%= t('by') %> <%= props.challenge.author %>
        <% } %>
      </span>
    <% } %><% if (!props.challenge.date && props.challenge.author) { %><span style="display: inline-block; margin-left:8px; margin-right: 8px; color: #313131">•</span>
        <span style="color:gray"><%= t('created')%> <%= t('by') %> <%= props.challenge.author %></span>
    <% } %><% if (props.correct !== true) { %>
      <span style="display: inline-block; margin-left:8px; margin-right: 8px; color: #313131">•</span><% if (props.withComlink) { %><a href="/feedback/<%= props.challenge.id %>" style="color:gray"><%=locale == 'de'? 'Frage stellen' : 'ask a question'%></a><% } else { %><a href="/hints/<%= props.challenge.id %>" style="color:gray">Hinweise (<%= props.hintsCount%>)</a><% } %>
    <% } %>
  </p>

  <div style="height:16px"></div>

  <% if (props.answer) { %>
    <p class="text-<%= props.correct === true ? App.config.styles.solutionClass_correct : App.config.styles.solutionClass_wrong %>">
      <% if (props.correct === 'none') { %>
        <strong><%= props.answer %></strong>
      <% } else { %>
        <strong><%= props.rawAnswer ? props.answer : `'${props.answer}'` %> <%= props.rawAnswer ? '' : props.correct ? t('correct') : t('wrong') %></strong>
      <% } %>
    </p>
  <% } %>

  <div style="height:16px"></div>

  <% if (props.correct === true) { %>
    <%- props.afterSolveText %>
    <% if (props.challenge.enableFeedback) { %>
      <div id="feedback-section" data-chal-id="<%= props.challenge.id %>">
        <p style="margin-top: 24px;"><%= t('feedback.heading') %></p>
        <ul class="feedback-list">
          <li style="margin-bottom: 12px;"><a href="<%=prefix%>/map" id="continue-button" class="feedback-link" data-key="fun"><%= t('feedback.fun') %></a></li>
          <li style="margin-bottom: 12px;"><a href="<%=prefix%>/map" class="feedback-link" data-key="learn"><%= t('feedback.learn') %></a></li>
          <li style="margin-bottom: 12px;"><a href="<%=prefix%>/map" class="feedback-link" data-key="nice"><%= t('feedback.nice') %></a></li>
          <li style="margin-bottom: 12px;"><a href="<%=prefix%>/map" class="feedback-link" data-key="ok"><%= t('feedback.ok') %></a></li>
        </ul>
      </div>
      <script>
        (function() {
          var container = document.getElementById('feedback-section');
          if (!container) return;
          var links = container.querySelectorAll('a');
          for (var i = 0; i < links.length; i++) {
            links[i].addEventListener('click', function (e) {
              e.preventDefault();
              try {
                var dataKey = this.getAttribute('data-key') || 'unknown';
                var chalId = container.getAttribute('data-chal-id');
                var eventKey = 'feedback_' + chalId + '_' + dataKey;
                var url = '/api/event?key=' + encodeURIComponent(eventKey);
                if (window.fetch) {
                  fetch(url)
                } else {
                  // Fallback
                  var img = new Image();
                  img.src = url;
                }
              } catch (err) {
                // ignore telemetry errors
              }
              var href = this.getAttribute('href');
              setTimeout(function() {
                alert("<%- t('feedback.thanks') %>")
                if (href) {
                  window.location.href = href;
                }
              }, 200);
            });
          }
        })();
      </script>
    <% } else { %>
      <p><a href="<%=prefix%>/map" id="continue-button"><%= t('continue') %></a></p>
    <% } %>
  <% } else { %>
    <%- props.html %>
    <% if (!props.challenge.hidesubmit) { %>
      <form autocomplete="off" method="post" id="challenge_form" style="display: flex; align-items: center;">
        <input id="challenge_answer" class="form-control" type="text" name="answer" style="height: 32px; width: 200px;">
        <input type="submit" id="challenge_submit" class="btn btn-interaction" value="<%= t('go') %>" style="height: 32px; line-height: 1; margin-left: 10px;">
</form>
    <% } %>
  <% } %>

  <div style="height:200px"></div>

  <p>
    <small style="display: inline-block; color: rgb(110, 110, 110); margin-top: 6px; margin-bottom: 8px;"><%= props.solvedBy == 1 ? t('solvedBy_one', {count: props.solvedBy}) : t('solvedBy_other', {count: props.solvedBy}) %><% if (props.lastSolved !== null) { %><%= ', ' + t('lastSolved', {ago: App.moment(props.lastSolved).locale(locale).fromNow(), name: props.lastSolvedUserName})%> [<a href="/solvers/<%=props.challenge.id%>" style="color: rgb(110, 110, 110);"><%=t('history')%></a>]<%}%></small>
  </p>

<% } %>

<% if (locale === 'de' && props.withComlink) { %>
  <link rel="stylesheet" href="/comlink/styles.css">
  <script src="/comlink/<%=props.challenge.id%>.js"></script>
  <script src="/comlink/client.js"></script>
<% } %>