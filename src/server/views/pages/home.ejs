
<style>
    /* Hover container: always 18px high, handles pointer/hover */
    .progress-pride-container {
        height: 22px;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        z-index: 10;
    }

    /* Visible stripe: expands to 18px on container hover */
    .progress-pride-stripe {
        height: 5px; /* default visible thickness */
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        transition: all 500ms ease;
        transition-delay: 500ms;
        will-change: height;
        background: linear-gradient(to right,
            /* Progress Chevron Colors */
            #000000 9.09%,
            #613915 9.09% 18.18%,
            #FFFFFF 18.18% 27.27%,
            #FFAFC8 27.27% 36.36%,
            #74D7EE 36.36% 45.45%,
            /* Traditional Rainbow Colors */
            #E40303 45.45% 54.54%,
            #FF8C00 54.54% 63.63%,
            #FFED00 63.63% 72.72%,
            #008026 72.72% 81.81%,
            #004DFF 81.81% 90.9%,
            #750787 90.9% 100%
        );
    }

    .progress-pride-container:hover .progress-pride-stripe {
        height: 22px;
        box-shadow: 0 3px 6px rgba(255, 255, 255, 0.25);
        transition-delay: 0ms;
        transition: all 200ms ease;
    }

    /* Easter-egg info panel connected below the stripe */
    .pride-info-panel {
        position: fixed;
        z-index: 9999;
        display: none;
        background: rgba(20, 20, 24, 0.96);
        color: #fff;
        border: 2px solid var(--accent, #777);
        padding: 12px 14px;
        border-radius: 10px;
        box-shadow: 0 4px 12px var(--accent, #777);
        max-width: 440px;
        font-size: 16px;
        line-height: 1.45;
        pointer-events: none; /* keep hover on the stripe */
        backdrop-filter: saturate(140%) blur(2px);
        transition: opacity 480ms ease;
        opacity: 0;
        --connector-h: 16px; /* height of triangle connector */
    }
    .pride-info-panel[data-visible="true"] {
        opacity: 1;
    }
    .pride-info-panel::before {
        content: "";
        position: absolute;
        top: calc(-1 * var(--connector-h));
        left: var(--pointer-x, 50%);
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: calc(var(--connector-h) * 0.9) solid transparent;
        border-right: calc(var(--connector-h) * 0.9) solid transparent;
        border-bottom: var(--connector-h) solid var(--accent, #777);
        filter: drop-shadow(0 2px 2px rgba(0,0,0,0.25));
    }
</style>

<div class="progress-pride-container">
    <div class="progress-pride-stripe"></div>
</div>
<div id="pridePanel" class="pride-info-panel" role="note" aria-live="polite" aria-hidden="true"></div>

<%- include('../partials/languagePicker', {t, App, locale}) %>

<h2><%= t('loginHeading') %></h2>

<% if (props.invalidLogin) { %>
  <div class="alert alert-danger"><%= t('invalid') %></div>
<% } %>

<form action="/login" method="post" autocomplete="off" id="login-form">
  <div class="form-group" style="display: flex; align-items: end;">
    <label><%= t('name') %> <input class="form-control" type="text" name="username" value="" autofocus id="inputName" style="width: 212px;"/></label>
    <span style="display:inline-block;width:6px;"></span>
    <label style="margin-left:8px;"><%= t('password') %> <input class="form-control" type="password" name="password" value="" id="inputPw" style="width: 212px;"/></label>
    <span style="display:inline-block;width:15px;"></span>
    <button type="submit" class="btn btn-interaction" style="margin-bottom:8px;"><%= t('go') %></button>
  </div>
</form>

<p class="my-4">
  <%- t('invite_', {link: `<a href="/register">${ t('registerLink') }</a>`}) %>
</p>

<hr class="my-5"/>

<h2><%= t('top10') %></h2>

<%- include('../partials/highscoreTable', {users:props.users, t, user, hideRank: false}) %>

<p style="margin-top: 24px;">[<a href="/highscore">Highscore</a>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<a href="/highscore?sort=new" style="white-space: nowrap;"><%=t('showRecent')%></a>]</p>

<% if (locale == 'de') { %>
  <hr class="my-5"/>

  <h2>Erfahrungsberichte</h2>

  <div class="container mt-4">
      <div class="row">
          <div class="col-md-4 mb-4">
              <div class="card">
                  <div class="card-body">
                      <p class="card-text">„Es ist simple aufgebaut, aber es macht sehr viel Spaß die Aufgaben zu lösen. Generell einfach ein guter vibe“</p>
                      <p style="text-align: right">S.</p>
                  </div>
              </div>
          </div>
          <div class="col-md-4 mb-4">
              <div class="card">
                  <div class="card-body">
                      <p class="card-text">„Es hat mir sehr gut gefallen dass es auch Gaming Rätsel gibt“</p>
                      <p style="text-align: right">E.</p>
                  </div>
              </div>
          </div>
          <div class="col-md-4 mb-4">
              <div class="card">
                  <div class="card-body">
                      <p class="card-text">„Ich war schon ein großer Fan von hacker.org und fühle mich direkt daran erinnert.“</p>
                      <p style="text-align: right">Y.</p>
                  </div>
              </div>
          </div>
          <div class="col-md-4 mb-4">
              <div class="card">
                  <div class="card-body">
                      <p class="card-text">„Hack the Web hat mir besonders gefallen da es meinen Horizont im Thema Hacking und IT erweitert hat “</p>
                      <p style="text-align: right">S.</p>
                  </div>
              </div>
          </div>
          <div class="col-md-4 mb-4">
              <div class="card">
                  <div class="card-body">
                      <p class="card-text">„Die große Variationen an Aufgaben ist super! Macht Spaß zurück zu kommen“</p>
                      <p style="text-align: right">S.</p>
                  </div>
              </div>
          </div>
          <div class="col-md-4 mb-4">
              <div class="card">
                  <div class="card-body">
                      <p class="card-text">„Mir hat es besonders viel Spass bereitet, über die verschiedenen Arten des Hackings und der jetzt offenen Möglichkeiten zu lernen. Basically limitless....“</p>
                      <p style="text-align: right">S.</p>
                  </div>
              </div>
          </div>
      </div>
  </div>


<% } %>

<hr class="my-5"/>

<h2><%= t('rooms') %></h2>

<p><%- t('inviteOrga_', {link: `<strong><a href="/create">${t('createRoom')}</a></strong>`}) %></p>

<p>[<a href="/join"><%= t('joinRoom') %></a>]</p>

<hr class="my-5"/>

<%- t('supporter_') %>

<p>
  <a href="/contact"><%= t('contactLink') %></a> |
  <a href="/privacy"><%= t('privacyLink') %></a> | 
  <a href="<%=App.config.githubHref%>" <% if (App.config.githubTargetBlank) { %> target="_blank" <% } %>><%= t('github') %></a> | 
  Version: <%=App.version%> (<a href="https://github.com/Entkenntnis/htw/releases" target="_blank"><%= t('news') %></a>)
</p>

<script>
    (function () {
        const container = document.querySelector('.progress-pride-container');
        const stripe = document.querySelector('.progress-pride-stripe');
        const panel = document.getElementById('pridePanel');
        if (!container || !stripe || !panel) return;

        // Segment end percentages correspond to the CSS gradient stops above
        const segmentEnds = [9.09, 18.18, 27.27, 36.36, 45.45, 54.54, 63.63, 72.72, 81.81, 90.9, 100];
        const segmentColors = [
            '#000000',
            '#613915',
            '#FFFFFF',
            '#FFAFC8',
            '#74D7EE',
            '#E40303',
            '#FF8C00',
            '#FFED00',
            '#008026',
            '#004DFF',
            '#750787'
        ];

        // Localized messages (3–4 sentences each)
        const messages = {
            de: [
                'Achte auf deine <b>Privatsphäre</b>. Ein einziges Foto kann deinen Standort verraten (EXIF-Metadaten, markante Orte).',
                'Behandle personenbezogene Daten als wertvoll; oft reichen Fantasieangaben.',
                '<b>Kryptographie</b> verschlüsselt (AES), sorgt für eine sichere Internet-Verbindung (TLS) und schützt Passwörter (Hashes).',
                '<b>Social Engineering</b> nutzt Vertrauen aus: Phishing-E-Mails, Fake‑Websites, Malware in unscheinbaren Apps.',
                'Dein digitaler Selbstschutz: skeptisch bleiben, Quellen prüfen, im Zweifel nachfragen.',
                'Das <b>Red Team</b> simuliert Angriffe; ein Capture-The-Flag (CTF) erlaubt legales Üben mit klaren Regeln.',
                'Der Browser ist offen: <b>Quelltext</b> ansehen und mit F12 die Struktur erkunden.',
                '<b>Adblocker</b> und Browser-Erweiterungen können dein Surferlebnis massiv verbessern.',
                'Hacken ist für Alle, nicht nur für privilegierte, weiße Männer. Wenn dir jemand sagt, dass du nicht dazugehörst: Zeig den Mittelfinger.',
                'Das <b>Blue Team</b> verteidigt und setzt auf Sichtbarkeit: Auffälligkeiten schnell erkennen und reagieren.',
                'Deine <b>Aufmerksamkeit</b> ist begehrt; Plattformen binden und monetarisieren sie. Entscheide lieber selbst statt dem Algorithmus zu folgen.',
            ],
            en: [
                'Mind your <b>privacy</b>. A single photo can reveal your location (EXIF metadata, recognizable places).',
                'Treat personal data as valuable; made‑up details often suffice.',
                '<b>Cryptography</b> encrypts (AES), secures internet connections (TLS), and protects passwords (hashes).',
                '<b>Social engineering</b> exploits trust: phishing emails, fake websites, malware in innocuous apps.',
                'Your digital self‑defense: stay skeptical, verify sources, ask when in doubt.',
                'The <b>red team</b> simulates attacks; a Capture‑The‑Flag (CTF) enables legal practice with clear rules.',
                'The browser is open: view the <b>source</b> and explore the structure with F12.',
                '<b>Ad blockers</b> and browser extensions can massively improve your browsing experience.',
                'Hacking is for everyone, not just privileged white men. If someone says you don’t belong, ignore the gatekeeping and keep going.',
                'The <b>blue team</b> defends and relies on visibility: detect anomalies quickly and respond.',
                'Your <b>attention</b> is coveted; platforms capture and monetize it. Choose for yourself rather than following the algorithm.'
            ]
        };

        const lang = '<%= locale %>' === 'de' ? 'de' : 'en';

        function segmentIndex(percent) {
            for (let i = 0; i < segmentEnds.length; i++) {
                if (percent <= segmentEnds[i]) return i;
            }
            return segmentEnds.length - 1;
        }

        function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

        function updatePanel(e) {
            const rect = container.getBoundingClientRect();
            const relX = clamp(e.clientX - rect.left, 0, rect.width);
            const percent = (relX / rect.width) * 100;
            const idx = segmentIndex(percent);
            const text = messages[lang][idx] || '';

            const color = segmentColors[idx] || '#777';
            panel.innerHTML = text;
            panel.style.setProperty('--accent', color);
            panel.style.borderColor = color;
            panel.style.display = 'block';
            panel.dataset.visible = 'true';
            panel.setAttribute('aria-hidden', 'false');

            // Compute the center X of the active color segment
            const prevEnd = idx === 0 ? 0 : segmentEnds[idx - 1];
            const end = segmentEnds[idx];
            const midPercent = (prevEnd + end) / 2;
            const segmentCenterX = rect.left + (midPercent / 100) * rect.width;

            // Place the panel directly below the stripe, centered on the active segment
            const width = 440;
            const desiredLeft = segmentCenterX - width / 2;
            const maxLeft = window.innerWidth - 12 - width;
            const left = clamp(desiredLeft, 12, maxLeft);
            panel.style.left = left + 'px';

            // Keep a triangle connector touching the container's bottom edge
            const CONNECTOR = 16; // must match --connector-h
            panel.style.setProperty('--connector-h', CONNECTOR + 'px');
            panel.style.top = (rect.bottom + CONNECTOR) + 'px';

            // Position the connector at the center of the active segment relative to the panel
            const pointerX = segmentCenterX - left;
            panel.style.setProperty('--pointer-x', pointerX + 'px');
        }

        function hidePanel() {
            panel.dataset.visible = 'false';
            // panel.style.display = 'none';
            panel.setAttribute('aria-hidden', 'true');
        }

        container.addEventListener('mousemove', updatePanel);
        container.addEventListener('mouseenter', updatePanel);
        container.addEventListener('mouseleave', hidePanel);

        // --- Click to set global theme color variables ---
        function hexToRgb(hex) {
            const m = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            if (!m) return { r: 119, g: 119, b: 119 }; // fallback
            return { r: parseInt(m[1], 16), g: parseInt(m[2], 16), b: parseInt(m[3], 16) };
        }

        function applyMainColor(color) {
            const { r, g, b } = hexToRgb(color);
            document.documentElement.style.setProperty('--main-color', color);
            document.documentElement.style.setProperty('--main-color-rgb', r + ',' + g + ',' + b);
        }

        container.addEventListener('click', function (e) {
            const rect = container.getBoundingClientRect();
            const relX = clamp(e.clientX - rect.left, 0, rect.width);
            const percent = (relX / rect.width) * 100;
            const idx = segmentIndex(percent);
            const color = segmentColors[idx] || '#777';
            applyMainColor(color);
        });
    })();
</script>
